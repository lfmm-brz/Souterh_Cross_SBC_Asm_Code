   1:			;***********************************************************************
   2:			; MULTIPLEXING 7 SEG DISPLAYS - ROTATING TEXT
   3:			; SOUTHERN CROSS SBC - SCM 1.8 - PCB 3.3
   4:			; zmac version 18oct2022        http://48k.ca/zmac.html
   5:			;***********************************************************************
   6:	2000          			   ORG	   2000H
   7:				
   8:	0084          	DIS_SEG    EQU     84H             ;DISPLAY SEGMENT DRIVER LATCH
   9:	0085          	DIS_CATH   EQU     85H             ;DISPLAY CATHODE DRIVER LATCH
  10:			
  11:			;***********************************************************************
  12:			; MAIN
  13:			;***********************************************************************
  14:	2000  215C20  	START:		LD		HL,MY_TEXT				; HL has the first letter of my msg
  15:	2003  228720  				LD		(LTR_ON_FRST_DISP),HL	; LTR_ON_FRST_DISP has the 
  16:														; letter on the first displsy
  17:			
  18:	2006  11DE00  	LOOP1:		LD		DE, 00DEH				; Load DE with the value nnnnH (LOOP1 counter)	
  19:						; LOOP2 starts here
  20:	2009          	LOOP2:
  21:						; start of my routine inside of LOOP2
  22:	2009  2A8720  				LD		HL,(LTR_ON_FRST_DISP);
  23:			
  24:	200C  7E      	LOOP3:      LD      A,(HL)				;Segments A,B,C,E,F and G
  25:	200D  D384    	            OUT     (DIS_SEG),A			;Send it to LED Segments Latch
  26:	200F  3A8920  	            LD      A,(DISPLAY)			;Turn on display
  27:	2012  D385    	            OUT     (DIS_CATH),A      
  28:	2014  CD4120  	            CALL	DELAY
  29:	2017  AF      				XOR		A
  30:	2018  D385    	            OUT     (DIS_CATH),A		;Turn off Segments
  31:			            
  32:	201A  23      	            INC		HL
  33:	201B  CD3A20  	            CALL	CHKEND
  34:	201E  3A8920  				LD      A,(DISPLAY)
  35:	2021  0F      				RRCA						; shift to right to turn on the next display
  36:	2022  328920  				LD		(DISPLAY),A			;
  37:	2025  30E5    				JR		NC,LOOP3			; if it is not the most right display, do LOOP3
  38:	2027  3E20    				LD		A,20H				; if it was the most right display, start from the most left
  39:	2029  328920  				LD		(DISPLAY),A			;
  40:	202C  2A8720  				LD		HL,(LTR_ON_FRST_DISP) ;repeat the loop with the same letters           
  41:						; end of my routine inside of LOOP2
  42:			   
  43:	202F  1B      				DEC		DE					; Decrement DE (DE = DE - 1)
  44:	2030  7A      				LD      A,D					; Load the high byte of DE (D register) into A
  45:	2031  B3      				OR      E					; Logical OR with the low byte (E register)
  46:	2032  20D5    				JR      NZ,LOOP2			; If DE is not zero (A != 0), jump to LoopStart
  47:						; LOOP2 ends here
  48:						
  49:	2034  23      				INC		HL						; since we have repeated the loop DE times
  50:	2035  228720  				LD		(LTR_ON_FRST_DISP),HL	; we go to the next letter
  51:	2038  18CC    	            JR      LOOP1
  52:			;***********************************************************************
  53:			
  54:			;***********************************************************************
  55:			; CHECK END OF MSG            
  56:			;***********************************************************************
  57:	203A  7E      	CHKEND:		LD		A,(HL)				; load A with the actual letter
  58:	203B  FE01    				CP		EOT					; check if it is the end of my string
  59:	203D  CA0020  				JP		Z,START				; if yes we start again
  60:	2040  C9      				RET
  61:			;***********************************************************************
  62:			
  63:			;***********************************************************************
  64:			; DELAY
  65:			;***********************************************************************
  66:	2041  F5      	DELAY:		PUSH	AF
  67:	2042  C5      				PUSH	BC
  68:	2043  D5      				PUSH	DE
  69:	2044  E5      				PUSH	HL
  70:						
  71:	2045  010700  				LD		BC,0007h			;Loads BC with hex 1000
  72:	2048  110700  	OUTER:		LD		DE,0007h			;Loads DE with hex 1000
  73:	204B  1B      	INNER:		DEC		DE					;Decrements DE
  74:	204C  7A      				LD		A,D					;Copies D into A
  75:	204D  B3      				OR		E					;Bitwise OR of E with A (now, A = D | E)
  76:	204E  C24B20  				JP		NZ,INNER			;Jumps back to Inner: label if A is not zero
  77:	2051  0B      				DEC		BC					;Decrements BC
  78:	2052  78      				LD		A,B
  79:	2053  B1      				OR		C					;Bitwise OR of C with A (now, A = B | C)
  80:	2054  C24820  				JP		NZ,OUTER
  81:						
  82:	2057  E1      				POP		HL
  83:	2058  D1      				POP		DE
  84:	2059  C1      				POP		BC
  85:	205A  F1      				POP		AF
  86:	205B  C9      				RET   
  87:			;***********************************************************************
  88:			
  89:			;***********************************************************************
  90:			; MY TEXT
  91:			;***********************************************************************
  92:	205C          	MY_TEXT:
  93:	205C  00000000			DB CHAR_SPC, CHAR_SPC, CHAR_SPC, CHAR_SPC, CHAR_SPC;
	      00
  94:	2061  6D3F3E78			DB CHAR_S, CHAR_O, CHAR_U, CHAR_T, CHAR_H, CHAR_E;
	      7679
  95:	2067  33540039			DB CHAR_R, CHAR_N, CHAR_SPC, CHAR_C, CHAR_R, CHAR_O;
	      333F
  96:	206D  6D6D006D			DB CHAR_S, CHAR_S, CHAR_SPC, CHAR_S, CHAR_B, CHAR_C;
	      7C39
  97:	2073  006D3937			DB CHAR_SPC, CHAR_S, CHAR_C, CHAR_M, CHAR_1d;
	      86
  98:	2078  7F007339			DB CHAR_8, CHAR_SPC, CHAR_P, CHAR_C, CHAR_B, CHAR_SPC;
	      7C00
  99:	207E  CF4F0000			DB CHAR_3d, CHAR_3, CHAR_SPC, CHAR_SPC, CHAR_SPC;
	      00
 100:	2083  00000001			DB CHAR_SPC, CHAR_SPC, CHAR_SPC, EOT;
 101:			;***********************************************************************
 102:			
 103:			;***********************************************************************
 104:			; VARIABLES
 105:			;***********************************************************************
 106:	2087  0000    	LTR_ON_FRST_DISP	DW		0000H;
 107:	2089  20      	DISPLAY				DB		20H;
 108:			;***********************************************************************
 109:			
 110:			;***********************************************************************
 111:			; CHARACTERS DEFINITIONS
 112:			;***********************************************************************            
 113:	0077          	CHAR_A	EQU 77H;
 114:	007C          	CHAR_B	EQU 7CH;
 115:	0039          	CHAR_C	EQU 39H;
 116:	005E          	CHAR_D	EQU 5EH;
 117:	0079          	CHAR_E	EQU 79H;
 118:	0071          	CHAR_F	EQU 71H;
 119:	003D          	CHAR_G	EQU 3DH;
 120:	0076          	CHAR_H	EQU 76H;
 121:	0030          	CHAR_I	EQU 30H;
 122:	001E          	CHAR_J	EQU 1EH;
 123:	0075          	CHAR_K	EQU 75H;
 124:	0038          	CHAR_L	EQU 38H;
 125:	0037          	CHAR_M	EQU 37H;
 126:	0054          	CHAR_N	EQU 54H;
 127:	003F          	CHAR_O	EQU 3FH;
 128:	0073          	CHAR_P	EQU 73H;
 129:	0067          	CHAR_Q	EQU 67H;
 130:	0033          	CHAR_R	EQU 33H;
 131:	006D          	CHAR_S	EQU 6DH;
 132:	0078          	CHAR_T	EQU 78H;
 133:	003E          	CHAR_U	EQU 3EH;
 134:	0062          	CHAR_V	EQU 62H;
 135:	002A          	CHAR_W	EQU 2AH;
 136:	0076          	CHAR_X	EQU 76H;
 137:	006E          	CHAR_Y	EQU 6EH;
 138:	005B          	CHAR_Z	EQU 5BH;
 139:	003F          	CHAR_0	EQU 3FH;
 140:	0006          	CHAR_1	EQU 06H;
 141:	005B          	CHAR_2	EQU 5BH;
 142:	004F          	CHAR_3	EQU 4FH;
 143:	0066          	CHAR_4	EQU 66H;
 144:	006D          	CHAR_5	EQU 6DH;
 145:	007D          	CHAR_6	EQU 7DH;
 146:	0007          	CHAR_7	EQU 07H;
 147:	007F          	CHAR_8	EQU 7FH;
 148:	006F          	CHAR_9	EQU 6FH;
 149:			
 150:	0086          	CHAR_1d	EQU 86H;		1.
 151:	00CF          	CHAR_3d	EQU 0CFH;		3.
 152:			
 153:	0000          	CHAR_SPC	EQU 00H;	space
 154:	0080          	CHAR_DOT	EQU 80H;	dot
 155:	0001          	EOT			EQU	01H;	end of text
 156:			;***********************************************************************
 157:			
 158:	208A          		END



Statistics:

     4	passes
     0	jr promotions
    54	symbols
   138	bytes



Symbol Table:

CHAR_0         =3F        63
CHAR_1         =06        6
CHAR_1d        =86        134
CHAR_2         =5B        91
CHAR_3         =4F        79
CHAR_3d        =CF        207
CHAR_4         =66        102
CHAR_5         =6D        109
CHAR_6         =7D        125
CHAR_7         =07        7
CHAR_8         =7F        127
CHAR_9         =6F        111
CHAR_A         =77        119
CHAR_B         =7C        124
CHAR_C         =39        57
CHAR_D         =5E        94
CHAR_DOT       =80        128
CHAR_E         =79        121
CHAR_F         =71        113
CHAR_G         =3D        61
CHAR_H         =76        118
CHAR_I         =30        48
CHAR_J         =1E        30
CHAR_K         =75        117
CHAR_L         =38        56
CHAR_M         =37        55
CHAR_N         =54        84
CHAR_O         =3F        63
CHAR_P         =73        115
CHAR_Q         =67        103
CHAR_R         =33        51
CHAR_S         =6D        109
CHAR_SPC       =00        0
CHAR_T         =78        120
CHAR_U         =3E        62
CHAR_V         =62        98
CHAR_W         =2A        42
CHAR_X         =76        118
CHAR_Y         =6E        110
CHAR_Z         =5B        91
CHKEND          203A      8250
DELAY           2041      8257
DISPLAY         2089      8329
DIS_CATH       =85        133
DIS_SEG        =84        132
EOT            =01        1
INNER           204B      8267
LOOP1           2006      8198
LOOP2           2009      8201
LOOP3           200C      8204
LTR_ON_FRST_DISP 2087      8327
MY_TEXT         205C      8284
OUTER           2048      8264
START           2000      8192
